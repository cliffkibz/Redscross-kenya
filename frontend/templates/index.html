{% extends "base.html" %}

{% block title %}Home - Red Cross Kenya{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Background slideshow logic
    const bgImages = [
        // Replace these URLs with your own Red Cross images
        'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1200&q=80',
        'https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=1200&q=80',
        'https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?auto=format&fit=crop&w=1200&q=80',
        'https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=1200&q=80'
    ];
    let bgIndex = 0;
    const bgSlideshow = document.getElementById('bg-slideshow');
    function setBgImage(idx) {
        bgSlideshow.style.backgroundImage = `url('${bgImages[idx]}')`;
    }
    setBgImage(bgIndex);
    setInterval(() => {
        bgIndex = (bgIndex + 1) % bgImages.length;
        setBgImage(bgIndex);
    }, 5000); // Change image every 5 seconds

    // Live Alerts logic
    function getToken() {
        return localStorage.getItem('auth_token');
    }
    function fetchLiveAlerts() {
        const token = getToken();
        const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
        fetch('/api/incidents/?per_page=5', { headers })
            .then(response => {
                if (response.status === 401) {
                    const alertsList = document.getElementById('live-alerts');
                    alertsList.innerHTML = '<li>Please log in to view real-time alerts.</li>';
                    return null;
                }
                return response.json();
            })
            .then(data => {
                if (!data) return;
                const alertsList = document.getElementById('live-alerts');
                alertsList.innerHTML = '';
                if (data.incidents && data.incidents.length > 0) {
                    data.incidents.forEach(incident => {
                        let icon = '<i class="fas fa-exclamation-triangle text-danger"></i>';
                        if (incident.incident_type && incident.incident_type.toLowerCase().includes('fire')) {
                            icon = '<i class="fas fa-fire text-warning"></i>';
                        } else if (incident.incident_type && incident.incident_type.toLowerCase().includes('accident')) {
                            icon = '<i class="fas fa-car-crash text-primary"></i>';
                        }
                        const location = incident.location && incident.location.county ? incident.location.county : 'Unknown';
                        const time = new Date(incident.created_at).toLocaleString();
                        const li = document.createElement('li');
                        li.innerHTML = `${icon} <strong>${incident.title}</strong> in ${location}. <span class="text-muted">${time}</span>`;
                        alertsList.appendChild(li);
                    });
                } else {
                    alertsList.innerHTML = '<li>No recent incidents.</li>';
                }
            })
            .catch(() => {
                const alertsList = document.getElementById('live-alerts');
                alertsList.innerHTML = '<li>Error loading alerts.</li>';
            });
    }
    fetchLiveAlerts();
    setInterval(fetchLiveAlerts, 30000);
});
</script>
{% endblock %}

{% block content %}
<!-- Background Slideshow -->
<style>
#bg-slideshow {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    width: 100vw;
    height: 100vh;
    z-index: 0;
    opacity: 0.40; /* Slightly increased opacity for background effect */
    pointer-events: none;
    transition: background-image 1s ease-in-out;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}
#main-content {
    position: relative;
    z-index: 1;
}
</style>
<div id="bg-slideshow"></div>
<div id="main-content">
<div class="container mt-5">
    <!-- Hero Section -->
    <div class="row align-items-center mb-5">
        <div class="col-md-7 text-center text-md-start">
            <h1 class="display-4 fw-bold text-danger mb-3">
                Disaster Response & Emergency Management
            </h1>
            <p class="lead mb-4">
                Real-time incident reporting, resource allocation, and emergency alerts for a safer Kenya.
            </p>
            <div class="d-flex flex-wrap gap-3 justify-content-center justify-content-md-start">
                <a href="{{ url_for('auth.login') }}" class="btn btn-danger btn-lg"><i class="fas fa-exclamation-circle me-2"></i>Report Incident</a>
                <a href="{{ url_for('auth.register') }}" class="btn btn-warning btn-lg"><i class="fas fa-hands-helping me-2"></i>Request Help</a>
                <a href="{{ url_for('resources.get_resources') }}" class="btn btn-success btn-lg"><i class="fas fa-warehouse me-2"></i>View Resources</a>
            </div>
        </div>
        <div class="col-md-5 text-center mt-4 mt-md-0">
            <img src="{{ url_for('static', filename='logo/respo.png') }}" alt="Disaster Response" class="img-fluid" style="max-height: 260px;">
        </div>
    </div>

    <!-- Live Alerts / Recent Incidents -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card border-danger shadow-sm">
                <div class="card-header bg-danger text-white">
                    <i class="fas fa-bolt"></i> Live Alerts & Recent Incidents
                </div>
                <div class="card-body p-3">
                    <ul class="list-unstyled mb-0" id="live-alerts">
                        <li><i class="fas fa-exclamation-triangle text-danger"></i> <strong>Flood reported</strong> in Kisumu County. <span class="text-muted">2 mins ago</span></li>
                        <li><i class="fas fa-fire text-warning"></i> <strong>Fire outbreak</strong> in Nairobi CBD. <span class="text-muted">10 mins ago</span></li>
                        <li><i class="fas fa-car-crash text-primary"></i> <strong>Road accident</strong> on Mombasa Road. <span class="text-muted">20 mins ago</span></li>
                        <!-- Dynamic content can be loaded here -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Section -->
    <div class="row mb-5 text-center">
        <div class="col-md-4 mb-3">
            <div class="card border-danger h-100">
                <div class="card-body">
                    <i class="fas fa-exclamation-triangle fa-2x text-danger mb-2"></i>
                    <h5>Incidents Reported</h5>
                    <h2 class="text-danger">1,245</h2>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card border-warning h-100">
                <div class="card-body">
                    <i class="fas fa-user-shield fa-2x text-warning mb-2"></i>
                    <h5>Active Responders</h5>
                    <h2 class="text-warning">320</h2>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card border-success h-100">
                <div class="card-body">
                    <i class="fas fa-warehouse fa-2x text-success mb-2"></i>
                    <h5>Resources Available</h5>
                    <h2 class="text-success">87</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Preparedness Tips -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card border-info">
                <div class="card-header bg-info text-white">
                    <i class="fas fa-info-circle"></i> Disaster Preparedness Tips
                </div>
                <div class="card-body">
                    <ul class="mb-0">
                        <li>Have an emergency kit ready with water, food, and first aid supplies.</li>
                        <li>Know your local emergency contacts and evacuation routes.</li>
                        <li>Stay informed via SMS alerts and local news.</li>
                        <li>Help neighbors and vulnerable community members.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Call to Action -->
    <div class="row mb-5">
        <div class="col-12 text-center">
            <a href="{{ url_for('auth.login') }}" class="btn btn-lg btn-danger me-2">Login</a>
            <a href="{{ url_for('auth.register') }}" class="btn btn-lg btn-success">Register</a>
        </div>
    </div>

    <div class="row">
        <div class="col-12 text-center">
            <div class="small"><a href="#">Need Help? Contact Support</a></div>
        </div>
    </div>
</div>
{% endblock %}
